            <!-- Modal Tools Library -->
            <div x-show="showToolsModal"
                @click.self="closeToolsModal()"
                class="modal-backdrop"
                x-transition>
                <div class="modal-content w-full max-w-5xl" @click.stop>
                    <!-- Header -->
                    <div
                        class="bg-purple-dark text-white px-6 py-4 rounded-t-lg flex items-center justify-between">
                        <h2 class="text-xl font-bold">üîß Biblioteca de
                            Herramientas</h2>
                        <button @click="closeToolsModal()"
                            class="text-2xl hover:text-purple-pale">&times;</button>
                    </div>

                    <!-- Tabs -->
                    <div class="flex border-b border-gray-200 bg-gray-50">
                        <button @click="toolsModalTab = 'cnc'"
                            :class="toolsModalTab === 'cnc' ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                            class="flex-1 px-6 py-3 text-sm transition">
                            üîß CNC
                        </button>
                        <button @click="toolsModalTab = 'plotter'"
                            :class="toolsModalTab === 'plotter' ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                            class="flex-1 px-6 py-3 text-sm transition">
                            ‚úÇÔ∏è Plotter
                        </button>
                        <button @click="toolsModalTab = 'pencil'"
                            :class="toolsModalTab === 'pencil' ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                            class="flex-1 px-6 py-3 text-sm transition">
                            ‚úèÔ∏è L√°piz
                        </button>
                    </div>

                    <div class="p-6">
                        <div class="grid grid-cols-2 gap-6">
                            <!-- Left: Tools List -->
                            <div>
                                <div
                                    class="flex items-center justify-between mb-4">
                                    <h3
                                        class="font-semibold text-purple-dark">Herramientas</h3>
                                    <button
                                        @click="resetToolForm(); editingTool = null"
                                        class="text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded transition">
                                        ‚ûï Nueva
                                    </button>
                                </div>

                                <div class="space-y-2 max-h-96 overflow-y-auto">
                                    <template
                                        x-for="tool in getToolsByCategory(toolsModalTab)"
                                        :key="tool.id">
                                        <div
                                            class="border rounded-lg p-3 hover:bg-purple-ultra-pale transition">
                                            <div
                                                class="flex items-start justify-between">
                                                <div class="flex-1">
                                                    <h4
                                                        class="font-medium text-sm"
                                                        x-text="tool.name"></h4>

                                                    <!-- CNC Info -->
                                                    <div
                                                        x-show="toolsModalTab === 'cnc'"
                                                        class="text-xs text-gray-600 mt-1">
                                                        <div>√ò <span
                                                                x-text="tool.diameter"></span>mm</div>
                                                        <div
                                                            x-show="tool.angle">√Ångulo:
                                                            <span
                                                                x-text="tool.angle"></span>¬∞</div>
                                                        <div><span
                                                                x-text="tool.feedRate"></span>
                                                            mm/min @ <span
                                                                x-text="tool.rpm"></span>
                                                            RPM</div>
                                                    </div>

                                                    <!-- Plotter Info -->
                                                    <div
                                                        x-show="toolsModalTab === 'plotter'"
                                                        class="text-xs text-gray-600 mt-1">
                                                        <div>√Ångulo: <span
                                                                x-text="tool.angle"></span>¬∞</div>
                                                        <div>Presi√≥n: <span
                                                                x-text="tool.pressure"></span></div>
                                                        <div>Velocidad: <span
                                                                x-text="tool.speed"></span>
                                                            mm/s</div>
                                                    </div>

                                                    <!-- Pencil Info -->
                                                    <div
                                                        x-show="toolsModalTab === 'pencil'"
                                                        class="text-xs text-gray-600 mt-1">
                                                        <div>Grosor: <span
                                                                x-text="tool.thickness"></span>mm</div>
                                                        <div>Velocidad: <span
                                                                x-text="tool.speed"></span>
                                                            mm/min</div>
                                                        <div
                                                            class="flex items-center gap-2">
                                                            Color: <div
                                                                class="w-4 h-4 rounded border"
                                                                :style="'background:' + tool.color"></div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="flex gap-2">
                                                    <button
                                                        @click="editTool(tool)"
                                                        class="text-purple-medium hover:text-purple-dark">
                                                        ‚úèÔ∏è
                                                    </button>
                                                    <button
                                                        @click="deleteTool(tool.id)"
                                                        class="text-red-500 hover:text-red-700">
                                                        üóëÔ∏è
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>

                                    <div
                                        x-show="getToolsByCategory(toolsModalTab).length === 0"
                                        class="text-center text-gray-400 py-8 text-sm">
                                        No hay herramientas en esta categor√≠a
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Tool Form -->
                            <div class="border-l pl-6">
                                <h3 class="font-semibold text-purple-dark mb-4">
                                    <span
                                        x-text="editingTool ? 'Editar Herramienta' : 'Nueva Herramienta'"></span>
                                </h3>

                                <div class="space-y-3">
                                    <!-- Common Fields -->
                                    <div>
                                        <label
                                            class="text-xs text-gray-600 block mb-1">Nombre
                                            *</label>
                                        <input type="text"
                                            x-model="toolForm.name"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                            placeholder="Ej: End Mill 3mm">
                                    </div>

                                    <!-- CNC Fields -->
                                    <template x-if="toolsModalTab === 'cnc'">
                                        <div class="space-y-3">
                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Tipo</label>
                                                <select x-model="toolForm.type"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                    <option value="endmill">End
                                                        Mill</option>
                                                    <option
                                                        value="ballnose">Ball
                                                        Nose</option>
                                                    <option
                                                        value="vbit">V-Bit</option>
                                                </select>
                                            </div>

                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label
                                                        class="text-xs text-gray-600 block mb-1">Di√°metro
                                                        (mm)</label>
                                                    <input type="number"
                                                        x-model.number="toolForm.diameter"
                                                        step="0.1"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                </div>
                                                <div
                                                    x-show="toolForm.type === 'vbit'">
                                                    <label
                                                        class="text-xs text-gray-600 block mb-1">√Ångulo
                                                        (¬∞)</label>
                                                    <input type="number"
                                                        x-model.number="toolForm.angle"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                </div>
                                            </div>

                                            <div class="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label
                                                        class="text-xs text-gray-600 block mb-1">Feed
                                                        Rate (mm/min)</label>
                                                    <input type="number"
                                                        x-model.number="toolForm.feedRate"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                </div>
                                                <div>
                                                    <label
                                                        class="text-xs text-gray-600 block mb-1">Plunge
                                                        Rate (mm/min)</label>
                                                    <input type="number"
                                                        x-model.number="toolForm.plungeRate"
                                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                </div>
                                            </div>

                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Spindle
                                                    RPM</label>
                                                <input type="number"
                                                    x-model.number="toolForm.rpm"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Plotter Fields -->
                                    <template
                                        x-if="toolsModalTab === 'plotter'">
                                        <div class="space-y-3">
                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">√Ångulo
                                                    Cuchilla (¬∞)</label>
                                                <select
                                                    x-model.number="toolForm.angle"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                                    <option
                                                        value="30">30¬∞</option>
                                                    <option
                                                        value="45">45¬∞</option>
                                                    <option
                                                        value="60">60¬∞</option>
                                                </select>
                                            </div>

                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Presi√≥n
                                                    (1-33)</label>
                                                <input type="number"
                                                    x-model.number="toolForm.pressure"
                                                    min="1" max="33"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                            </div>

                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Velocidad
                                                    (mm/s)</label>
                                                <input type="number"
                                                    x-model.number="toolForm.speed"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Pencil Fields -->
                                    <template x-if="toolsModalTab === 'pencil'">
                                        <div class="space-y-3">
                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Grosor
                                                    L√≠nea (mm)</label>
                                                <input type="number"
                                                    x-model.number="toolForm.thickness"
                                                    step="0.1"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                            </div>

                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Velocidad
                                                    (mm/min)</label>
                                                <input type="number"
                                                    x-model.number="toolForm.speed"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                            </div>

                                            <div>
                                                <label
                                                    class="text-xs text-gray-600 block mb-1">Color</label>
                                                <input type="color"
                                                    x-model="toolForm.color"
                                                    class="w-full h-10 border border-gray-300 rounded-lg">
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Notes (Common) -->
                                    <div>
                                        <label
                                            class="text-xs text-gray-600 block mb-1">Notas</label>
                                        <textarea x-model="toolForm.notes"
                                            rows="2"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                            placeholder="Informaci√≥n adicional..."></textarea>
                                    </div>

                                    <!-- Password -->
                                    <form @submit.prevent="saveTool()">
                                        <div>
                                            <label
                                                class="text-xs text-gray-600 block mb-1">Contrase√±a
                                                *</label>
                                            <input type="password"
                                                x-model="authPassword"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                placeholder="Requerida para guardar">
                                        </div>

                                        <!-- Save Button -->
                                        <button type="submit"
                                            class="w-full bg-purple-medium hover:bg-purple-dark text-white px-4 py-2 rounded-lg transition mt-3">
                                            üíæ Guardar Herramienta
                                        </button>
                                    </form>

                                    <!-- Status -->
                                    <div x-show="toolsStatus"
                                        class="p-3 rounded-lg text-sm text-center"
                                        :class="toolsStatus?.type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'">
                                        <span
                                            x-text="toolsStatus?.message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
