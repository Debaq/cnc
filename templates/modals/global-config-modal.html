<!-- Modal de Configuraci√≥n Global -->
<div x-show="activeModal === 'globalConfig'"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-50 overflow-y-auto"
     @click.self="closeModal">

    <!-- Overlay -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-10"></div>

    <!-- Modal Container -->
    <div class="flex items-center justify-center min-h-screen p-4 relative z-20">
        <div @click.stop
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col">

            <!-- Header -->
            <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-purple-500 to-purple-600 text-white">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold flex items-center gap-2">
                        <span>‚öôÔ∏è</span>
                        <span>Configuraci√≥n Global de Mecanizado</span>
                    </h2>
                    <button @click="closeModal"
                        class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-1 transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <p class="text-sm text-purple-100 mt-1">Esta configuraci√≥n se aplicar√° a todos los elementos que no tengan config personalizada</p>
            </div>

            <!-- Content (scrollable) -->
            <div class="flex-1 overflow-y-auto p-6">
                <div class="space-y-5">

                    <!-- Tipo de Operaci√≥n -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Tipo de Operaci√≥n</label>
                        <select x-model="globalConfig.operationType"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500">
                            <option value="cnc">üîß CNC Fresado</option>
                            <option value="laser">‚ö° L√°ser</option>
                            <option value="plotter">‚úÇÔ∏è Plotter Corte</option>
                            <option value="pencil">‚úèÔ∏è L√°piz/Marcador</option>
                        </select>
                    </div>

                    <!-- Herramienta (para CNC, Plotter, Pencil) -->
                    <div x-show="globalConfig.operationType !== 'laser'" class="bg-gray-50 rounded-lg p-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Herramienta</label>
                        <select x-model="globalConfig.tool"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500">
                            <option value="">Sin herramienta</option>
                            <template x-for="tool in tools.filter(t =>
                                (globalConfig.operationType === 'cnc' && t.category === 'cnc') ||
                                (globalConfig.operationType === 'plotter' && t.category === 'plotter') ||
                                (globalConfig.operationType === 'pencil' && t.category === 'pencil')
                            )" :key="tool.id">
                                <option :value="tool.name" x-text="tool.name"></option>
                            </template>
                        </select>
                    </div>

                    <!-- Par√°metros espec√≠ficos de CNC -->
                    <template x-if="globalConfig.operationType === 'cnc'">
                        <div class="space-y-4 bg-purple-ultra-pale rounded-lg p-4 border-l-4 border-purple-medium">
                            <h3 class="text-sm font-bold text-purple-dark">‚öôÔ∏è Par√°metros CNC</h3>

                            <!-- Tipo de Trabajo -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Tipo de Trabajo</label>
                                <select x-model="globalConfig.workType"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="outline">Contorno (sobre l√≠nea)</option>
                                    <option value="inside">Interior (por dentro)</option>
                                    <option value="outside">Exterior (por fuera)</option>
                                    <option value="pocket">Cajeado (vaciar interior)</option>
                                </select>
                            </div>

                            <!-- Compensaci√≥n de Herramienta -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Compensaci√≥n</label>
                                <select x-model="globalConfig.compensation"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="center">Centro</option>
                                    <option value="inside">Interior</option>
                                    <option value="outside">Exterior</option>
                                </select>
                            </div>

                            <!-- Profundidad y Paso -->
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Profundidad (mm)</label>
                                    <input type="number" x-model.number="globalConfig.depth" step="0.5"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Paso/Pasada (mm)</label>
                                    <input type="number" x-model.number="globalConfig.depthStep" step="0.1" min="0.1"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>

                            <!-- Di√°metro de Herramienta -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Di√°metro Herramienta (mm)</label>
                                <input type="number" x-model.number="globalConfig.toolDiameter" step="0.1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>

                            <!-- Velocidades CNC -->
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Feed (mm/min)</label>
                                    <input type="number" x-model.number="globalConfig.feedRate"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Plunge (mm/min)</label>
                                    <input type="number" x-model.number="globalConfig.plungeRate"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Spindle RPM</label>
                                <input type="number" x-model.number="globalConfig.spindleRPM"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </template>

                    <!-- Par√°metros espec√≠ficos de L√°ser -->
                    <template x-if="globalConfig.operationType === 'laser'">
                        <div class="space-y-4 bg-yellow-50 rounded-lg p-4 border-l-4 border-yellow-400">
                            <h3 class="text-sm font-bold text-yellow-800">‚ö° Par√°metros L√°ser</h3>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Potencia (%)</label>
                                    <input type="number" x-model.number="globalConfig.laserPower"
                                        min="0" max="100"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Pasadas</label>
                                    <input type="number" x-model.number="globalConfig.passes" min="1"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Velocidad (mm/min)</label>
                                <input type="number" x-model.number="globalConfig.feedRate"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </template>

                    <!-- Par√°metros espec√≠ficos de Plotter -->
                    <template x-if="globalConfig.operationType === 'plotter'">
                        <div class="space-y-4 bg-blue-50 rounded-lg p-4 border-l-4 border-blue-400">
                            <h3 class="text-sm font-bold text-blue-800">‚úÇÔ∏è Par√°metros Plotter</h3>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Presi√≥n (1-33)</label>
                                    <input type="number" x-model.number="globalConfig.pressure"
                                        min="1" max="33"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Velocidad (mm/s)</label>
                                    <input type="number" x-model.number="globalConfig.speed"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Pasadas</label>
                                <input type="number" x-model.number="globalConfig.passes" min="1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </template>

                    <!-- Par√°metros espec√≠ficos de L√°piz -->
                    <template x-if="globalConfig.operationType === 'pencil'">
                        <div class="space-y-4 bg-green-50 rounded-lg p-4 border-l-4 border-green-400">
                            <h3 class="text-sm font-bold text-green-800">‚úèÔ∏è Par√°metros L√°piz/Marcador</h3>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Presi√≥n Z (mm)</label>
                                    <input type="number" x-model.number="globalConfig.pressureZ" step="0.1"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Velocidad (mm/min)</label>
                                    <input type="number" x-model.number="globalConfig.speed"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                        </div>
                    </template>

                </div>
            </div>

            <!-- Footer con Acciones -->
            <div class="px-6 py-4 border-t border-gray-200 bg-gray-50">
                <div class="flex items-center justify-between gap-3">
                    <button @click="applyGlobalConfigToAll"
                        class="flex-1 px-4 py-2.5 bg-purple-medium hover:bg-purple-dark text-white rounded-lg text-sm font-medium transition flex items-center justify-center gap-2">
                        <span>‚úì</span>
                        <span>Aplicar a Todos los Elementos</span>
                    </button>
                    <button @click="closeModal"
                        class="px-6 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition">
                        Cerrar
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-2 text-center">
                    Los elementos con configuraci√≥n personalizada üéØ no se ver√°n afectados
                </p>
            </div>

        </div>
    </div>

</div>
