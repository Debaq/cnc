<!-- Modal de Configuraci√≥n Global -->
<div x-show="activeModal === 'globalConfig'"
     @click.self="closeModal()"
     class="modal-backdrop"
     x-transition>
    <div class="modal-content" style="max-width: 700px; max-height: 90vh;" @click.stop>
        <!-- Header -->
        <div class="modal-header-compact bg-purple-dark text-white rounded-t-lg">
            <div class="flex items-center justify-between">
                <h2>‚öôÔ∏è Configuraci√≥n Global de Mecanizado</h2>
                <button @click="closeModal()"
                    class="text-white hover:text-purple-pale leading-none">
                    &times;
                </button>
            </div>
            <p class="text-purple-pale mt-1">Esta configuraci√≥n se aplicar√° a todos los elementos que no tengan config personalizada</p>
        </div>

        <!-- Content (scrollable) -->
        <div class="modal-content-spacing overflow-y-auto" style="max-height: calc(90vh - 180px);">
                <div>

                    <!-- Tipo de Operaci√≥n -->
                    <div class="modal-section-compact bg-gray-50 rounded-lg">
                        <label class="modal-section-title-compact text-gray-700">Tipo de Operaci√≥n</label>
                        <select x-model="globalConfig.operationType"
                            class="form-select-compact">
                            <option value="cnc">üîß CNC Fresado</option>
                            <option value="laser">‚ö° L√°ser</option>
                            <option value="plotter">‚úÇÔ∏è Plotter Corte</option>
                            <option value="pencil">‚úèÔ∏è L√°piz/Marcador</option>
                        </select>
                    </div>

                    <!-- Herramienta (para CNC, Plotter, Pencil) -->
                    <div x-show="globalConfig.operationType !== 'laser'" class="bg-gray-50 rounded-lg p-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Herramienta</label>
                        <select x-model="globalConfig.tool"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500">
                            <option value="">Sin herramienta</option>
                            <template x-for="tool in tools.filter(t =>
                                (globalConfig.operationType === 'cnc' && t.category === 'cnc') ||
                                (globalConfig.operationType === 'plotter' && t.category === 'plotter') ||
                                (globalConfig.operationType === 'pencil' && t.category === 'pencil')
                            )" :key="tool.id">
                                <option :value="tool.name" x-text="tool.name"></option>
                            </template>
                        </select>
                    </div>

                    <!-- Par√°metros espec√≠ficos de CNC -->
                    <template x-if="globalConfig.operationType === 'cnc'">
                        <div class="space-y-4 bg-purple-ultra-pale rounded-lg p-4 border-l-4 border-purple-medium">
                            <h3 class="text-sm font-bold text-purple-dark">‚öôÔ∏è Par√°metros CNC</h3>

                            <!-- Tipo de Trabajo -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Tipo de Trabajo</label>
                                <select x-model="globalConfig.workType"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="outline">Contorno (sobre l√≠nea)</option>
                                    <option value="inside">Interior (por dentro)</option>
                                    <option value="outside">Exterior (por fuera)</option>
                                    <option value="pocket">Cajeado (vaciar interior)</option>
                                </select>
                            </div>

                            <!-- Compensaci√≥n de Herramienta -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Compensaci√≥n</label>
                                <select x-model="globalConfig.compensation"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="center">Centro</option>
                                    <option value="inside">Interior</option>
                                    <option value="outside">Exterior</option>
                                </select>
                            </div>

                            <!-- Profundidad y Paso -->
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Profundidad (mm)</label>
                                    <input type="number" x-model.number="globalConfig.depth" step="0.5"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Paso/Pasada (mm)</label>
                                    <input type="number" x-model.number="globalConfig.depthStep" step="0.1" min="0.1"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>

                            <!-- Di√°metro de Herramienta -->
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Di√°metro Herramienta (mm)</label>
                                <input type="number" x-model.number="globalConfig.toolDiameter" step="0.1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>

                            <!-- Velocidades CNC -->
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Feed (mm/min)</label>
                                    <input type="number" x-model.number="globalConfig.feedRate"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Plunge (mm/min)</label>
                                    <input type="number" x-model.number="globalConfig.plungeRate"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Spindle RPM</label>
                                <input type="number" x-model.number="globalConfig.spindleRPM"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </template>

                    <!-- Par√°metros espec√≠ficos de L√°ser -->
                    <template x-if="globalConfig.operationType === 'laser'">
                        <div class="space-y-4 bg-yellow-50 rounded-lg p-4 border-l-4 border-yellow-400">
                            <h3 class="text-sm font-bold text-yellow-800">‚ö° Par√°metros L√°ser</h3>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Potencia (%)</label>
                                    <input type="number" x-model.number="globalConfig.laserPower"
                                        min="0" max="100"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Pasadas</label>
                                    <input type="number" x-model.number="globalConfig.passes" min="1"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Velocidad (mm/min)</label>
                                <input type="number" x-model.number="globalConfig.feedRate"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </template>

                    <!-- Par√°metros espec√≠ficos de Plotter -->
                    <template x-if="globalConfig.operationType === 'plotter'">
                        <div class="space-y-4 bg-blue-50 rounded-lg p-4 border-l-4 border-blue-400">
                            <h3 class="text-sm font-bold text-blue-800">‚úÇÔ∏è Par√°metros Plotter</h3>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Presi√≥n (1-33)</label>
                                    <input type="number" x-model.number="globalConfig.pressure"
                                        min="1" max="33"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Velocidad (mm/s)</label>
                                    <input type="number" x-model.number="globalConfig.speed"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Pasadas</label>
                                <input type="number" x-model.number="globalConfig.passes" min="1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                        </div>
                    </template>

                    <!-- Par√°metros espec√≠ficos de L√°piz -->
                    <template x-if="globalConfig.operationType === 'pencil'">
                        <div class="space-y-4 bg-green-50 rounded-lg p-4 border-l-4 border-green-400">
                            <h3 class="text-sm font-bold text-green-800">‚úèÔ∏è Par√°metros L√°piz/Marcador</h3>

                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Presi√≥n Z (mm)</label>
                                    <input type="number" x-model.number="globalConfig.pressureZ" step="0.1"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-gray-700 mb-1">Velocidad (mm/min)</label>
                                    <input type="number" x-model.number="globalConfig.speed"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                            </div>
                        </div>
                    </template>

            </div>
        </div>

        <!-- Footer con Acciones -->
        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-lg">
            <div class="flex items-center gap-3">
                <button @click="applyGlobalConfigToAll()"
                    class="flex-1 px-4 py-2.5 bg-purple-medium hover:bg-purple-dark text-white rounded-lg text-sm font-medium transition">
                    ‚úì Aplicar a Todos los Elementos
                </button>
                <button @click="closeModal()"
                    class="px-6 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg text-sm font-medium transition">
                    Cerrar
                </button>
            </div>
            <p class="text-xs text-gray-500 mt-2 text-center">
                Los elementos con configuraci√≥n personalizada üéØ no se ver√°n afectados
            </p>
        </div>
    </div>
</div>
