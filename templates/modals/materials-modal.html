<!-- Modal Materials Library -->
<div x-show="showMaterialsModal"
    @click.self="closeMaterialsModal()"
    class="modal-backdrop"
    x-transition>
    <div class="modal-content w-full max-w-5xl" @click.stop>
        <!-- Header -->
        <div class="bg-purple-dark text-white px-6 py-4 rounded-t-lg flex items-center justify-between">
            <h2 class="text-xl font-bold">üì¶ Biblioteca de Materiales</h2>
            <button @click="closeMaterialsModal()"
                class="text-2xl hover:text-purple-pale">&times;</button>
        </div>

        <!-- Tabs -->
        <div class="flex border-b border-gray-200 bg-gray-50">
            <button @click="materialsModalTab = 'wood'"
                :class="materialsModalTab === 'wood' ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                class="flex-1 px-6 py-3 text-sm transition">
                üå≥ Madera
            </button>
            <button @click="materialsModalTab = 'plastic'"
                :class="materialsModalTab === 'plastic' ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                class="flex-1 px-6 py-3 text-sm transition">
                üî∑ Pl√°stico
            </button>
            <button @click="materialsModalTab = 'metal'"
                :class="materialsModalTab === 'metal' ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                class="flex-1 px-6 py-3 text-sm transition">
                ‚öôÔ∏è Metal
            </button>
        </div>

        <div class="p-6">
            <div class="grid grid-cols-2 gap-6">
                <!-- Left: Materials List -->
                <div>
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-purple-dark">Materiales</h3>
                        <button
                            @click="resetMaterialForm(); editingMaterial = null"
                            class="text-sm bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded transition">
                            ‚ûï Nuevo
                        </button>
                    </div>

                    <div class="space-y-2 max-h-96 overflow-y-auto">
                        <template
                            x-for="material in getMaterialsByCategory(materialsModalTab)"
                            :key="material.id">
                            <div class="border rounded-lg p-3 hover:bg-purple-ultra-pale transition">
                                <div class="flex items-start justify-between">
                                    <div class="flex-1">
                                        <h4 class="font-medium text-sm" x-text="material.name"></h4>

                                        <!-- Material Info -->
                                        <div class="text-xs text-gray-600 mt-1">
                                            <div class="flex items-center gap-2">
                                                <span>Grosor: <span x-text="material.thickness"></span>mm</span>
                                                <div class="w-4 h-4 rounded border" :style="'background:' + material.color"></div>
                                            </div>
                                            <div x-show="material.cnc">
                                                CNC: <span x-text="material.cnc?.feedRate"></span> mm/min @
                                                <span x-text="material.cnc?.rpm"></span> RPM
                                            </div>
                                            <div x-show="material.laser">
                                                L√°ser: <span x-text="material.laser?.cutPower"></span>% /
                                                <span x-text="material.laser?.cutSpeed"></span> mm/min
                                            </div>
                                            <div class="text-gray-500 italic text-xs" x-text="material.description"></div>
                                        </div>
                                    </div>

                                    <div class="flex gap-2">
                                        <button
                                            @click="editMaterial(material)"
                                            class="text-purple-medium hover:text-purple-dark">
                                            ‚úèÔ∏è
                                        </button>
                                        <button
                                            @click="deleteMaterial(material.id)"
                                            class="text-red-500 hover:text-red-700">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <div
                            x-show="getMaterialsByCategory(materialsModalTab).length === 0"
                            class="text-center text-gray-400 py-8 text-sm">
                            No hay materiales en esta categor√≠a
                        </div>
                    </div>
                </div>

                <!-- Right: Material Form -->
                <div class="border-l pl-6">
                    <h3 class="font-semibold text-purple-dark mb-4">
                        <span x-text="editingMaterial ? 'Editar Material' : 'Nuevo Material'"></span>
                    </h3>

                    <div class="space-y-3">
                        <!-- Common Fields -->
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">Nombre *</label>
                            <input type="text"
                                x-model="materialForm.name"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                placeholder="Ej: MDF 3mm">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs text-gray-600 block mb-1">Grosor (mm)</label>
                                <input type="number"
                                    x-model.number="materialForm.thickness"
                                    step="0.1"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="text-xs text-gray-600 block mb-1">Color</label>
                                <input type="color"
                                    x-model="materialForm.color"
                                    class="w-full h-10 border border-gray-300 rounded-lg">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs text-gray-600 block mb-1">Descripci√≥n</label>
                            <textarea x-model="materialForm.description"
                                rows="2"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                placeholder="Descripci√≥n del material..."></textarea>
                        </div>

                        <!-- CNC Settings -->
                        <div class="bg-purple-ultra-pale rounded-lg p-3 space-y-2">
                            <h4 class="font-semibold text-sm text-purple-dark">‚öôÔ∏è Configuraci√≥n CNC</h4>

                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Feed (mm/min)</label>
                                    <input type="number"
                                        x-model.number="materialForm.cncFeedRate"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Plunge (mm/min)</label>
                                    <input type="number"
                                        x-model.number="materialForm.cncPlungeRate"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">RPM</label>
                                    <input type="number"
                                        x-model.number="materialForm.cncRpm"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Paso (mm)</label>
                                    <input type="number"
                                        x-model.number="materialForm.cncDepthPerPass"
                                        step="0.1"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Laser Settings -->
                        <div class="bg-yellow-50 rounded-lg p-3 space-y-2">
                            <h4 class="font-semibold text-sm text-yellow-800">‚ö° Configuraci√≥n L√°ser</h4>

                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Potencia Corte (%)</label>
                                    <input type="number"
                                        x-model.number="materialForm.laserCutPower"
                                        min="0" max="100"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Vel. Corte (mm/min)</label>
                                    <input type="number"
                                        x-model.number="materialForm.laserCutSpeed"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Potencia Grab. (%)</label>
                                    <input type="number"
                                        x-model.number="materialForm.laserEngravePower"
                                        min="0" max="100"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="text-xs text-gray-600 block mb-1">Vel. Grab. (mm/min)</label>
                                    <input type="number"
                                        x-model.number="materialForm.laserEngraveSpeed"
                                        class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm">
                                </div>
                            </div>
                        </div>

                        <!-- Password -->
                        <form @submit.prevent="saveMaterial()">
                            <div>
                                <label class="text-xs text-gray-600 block mb-1">Contrase√±a *</label>
                                <input type="password"
                                    x-model="authPassword"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                    placeholder="Requerida para guardar">
                            </div>

                            <!-- Save Button -->
                            <button type="submit"
                                class="w-full bg-purple-medium hover:bg-purple-dark text-white px-4 py-2 rounded-lg transition mt-3">
                                üíæ Guardar Material
                            </button>
                        </form>

                        <!-- Status -->
                        <div x-show="materialsStatus"
                            class="p-3 rounded-lg text-sm text-center"
                            :class="materialsStatus?.type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'">
                            <span x-text="materialsStatus?.message"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
