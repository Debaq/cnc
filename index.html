<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GRBL Web Control Pro v4.0</title>
        <link rel="icon" type="image/x-icon" href="favicon.ico">

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
        tailwind.config = {
            suppressWarnings: true,
            theme: {
                extend: {
                    colors: {
                        purple: {
                            dark: '#2D1B69',
                            medium: '#5B4B9F',
                            light: '#7B6BB8',
                            pale: '#B5A8D6',
                            'ultra-pale': '#E8E4F3',
                            bg: '#F5F3FA'
                        }
                    }
                }
            }
        }
    </script>

        <!-- Fabric.js for canvas manipulation -->
        <script
            src="https://cdn.jsdelivr.net/npm/fabric@6.7.1/dist/index.min.js"></script>

        <!-- Makerjs for G-code generation -->
        <script src="https://maker.js.org/target/js/browser.maker.js" type="text/javascript"></script>


        <!-- Three.js for 3D G-code visualization -->
        <script src="https://unpkg.com/three@0.147.0/build/three.min.js"></script>
        <script src="https://unpkg.com/three@0.147.0/examples/js/controls/OrbitControls.js"></script>

        <!-- Custom Styles -->
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body class="bg-purple-bg">
        <div x-data="grblApp()" class="flex flex-col h-screen overflow-hidden">

            <!-- Header Horizontal -->
            <div x-template="'templates/components/header.html'"></div>

            <!-- Main Container -->
            <div class="flex-1 flex overflow-hidden">

                <!-- Panel Izquierdo Colapsable (Contextual seg√∫n workspace) -->
                <aside x-show="!leftPanelCollapsed"
                       x-transition:enter="transition ease-out duration-200"
                       x-transition:enter-start="-translate-x-full"
                       x-transition:enter-end="translate-x-0"
                       x-transition:leave="transition ease-in duration-200"
                       x-transition:leave-start="translate-x-0"
                       x-transition:leave-end="-translate-x-full"
                       class="w-80 bg-white border-r border-gray-200 flex flex-col overflow-hidden">
                    <!-- Contenido contextual seg√∫n el workspace activo -->
                    <div x-show="currentWorkspace === 'design'" class="flex-1 flex flex-col" x-template="'templates/workspaces/design-panel.html'"></div>
                    <div x-show="currentWorkspace === 'preview'" class="flex-1 flex flex-col" x-template="'templates/workspaces/preview-panel.html'"></div>
                    <div x-show="currentWorkspace === 'control'" class="flex-1 flex flex-col" x-template="'templates/components/sidebar.html'"></div>
                </aside>

                <!-- Bot√≥n Colapsar Panel -->
                <button @click="leftPanelCollapsed = !leftPanelCollapsed"
                        class="w-6 bg-gray-100 hover:bg-gray-200 border-r border-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-900 transition"
                        :title="leftPanelCollapsed ? 'Mostrar panel' : 'Ocultar panel'">
                    <span x-text="leftPanelCollapsed ? '‚ñ∂' : '‚óÄ'" class="text-xs"></span>
                </button>

                <!-- √Årea Central (Canvas maximizado) -->
                <main class="flex-1 flex flex-col overflow-hidden">

                    <!-- Hidden file input for SVG -->
                    <input type="file" accept=".svg" class="hidden"
                        x-ref="svgInput" @change="handleSVGUpload">

                    <!-- Canvas Toolbar (simplificado) -->
                    <div class="bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between">
                        <!-- Controles de Transformaci√≥n (solo para workspace dise√±o) -->
                        <div x-show="currentWorkspace === 'design'" class="flex items-center gap-2">

                            <div class="flex items-center gap-2">
                                <!-- Herramientas de Transformaci√≥n -->
                                <button @click="flipHorizontal"
                                    :disabled="!svgLoaded && elements.length === 0"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm disabled:opacity-50"
                                    title="Reflejar horizontalmente">
                                    ‚ÜîÔ∏è
                                </button>
                                <button @click="flipVertical"
                                    :disabled="!svgLoaded && elements.length === 0"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm disabled:opacity-50"
                                    title="Reflejar verticalmente">
                                    ‚ÜïÔ∏è
                                </button>
                                <div class="h-6 w-px bg-gray-300 mx-1"></div>

                                <!-- Herramientas de Vista -->
                                <button @click="zoomIn"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm">
                                    üîç+
                                </button>
                                <button @click="zoomOut"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm">
                                    üîç-
                                </button>
                                <button @click="fitView"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm"
                                    title="Centrar √°rea de trabajo">
                                    üéØ
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Canvas Area (workspace-dependent) -->
                    <div class="flex-1 p-4 relative overflow-hidden bg-purple-bg">
                        <!-- SVG Canvas (workspace: design) -->
                        <div x-show="currentWorkspace === 'design'" style="width: 100%; height: 100%;">
                            <canvas x-ref="canvas"
                                class="rounded-lg shadow-lg" style="display: block;"></canvas>
                        </div>

                        <!-- 3D Viewer Canvas (workspace: preview) -->
                        <div x-show="currentWorkspace === 'preview'" class="w-full h-full bg-gray-900 rounded-lg shadow-lg relative">
                            <canvas x-ref="viewer3d"
                                class="w-full h-full rounded-lg"></canvas>

                            <!-- Loading overlay for 3D view -->
                            <div x-show="!gcodeGenerated"
                                class="absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-90 rounded-lg">
                                <div class="text-center text-gray-400">
                                    <div class="text-6xl mb-4">üé¨</div>
                                    <p class="text-lg font-semibold">Vista 3D no disponible</p>
                                    <p class="text-sm mt-2">Genera G-code primero para ver</p>
                                    <p class="text-sm">la visualizaci√≥n 3D de las trayectorias</p>
                                </div>
                            </div>
                        </div>

                        <!-- Control/Console View (workspace: control) -->
                        <div x-show="currentWorkspace === 'control'" class="w-full h-full bg-white rounded-lg shadow-lg p-6">
                            <div class="text-center text-gray-500">
                                <div class="text-6xl mb-4">üïπÔ∏è</div>
                                <p class="text-lg font-semibold">√Årea de Control GRBL</p>
                                <p class="text-sm mt-2">Esta vista estar√° disponible pr√≥ximamente</p>
                            </div>
                        </div>
                    </div>

                    <!-- Canvas Footer -->
                    <div class="bg-white border-t border-gray-200 px-4 py-2 flex items-center justify-between text-xs text-gray-600">
                        <div class="flex items-center gap-6">
                            <span>Posici√≥n: <span x-text="svgPosition"></span></span>
                            <span>Escala: <span x-text="svgScale"></span></span>
                            <span>Rotaci√≥n: <span x-text="svgRotation"></span></span>
                        </div>
                    </div>
                </main>

            </div><!-- Fin Main Container -->

            <!-- Panel Flotante de Propiedades -->
            <div x-template="'templates/components/floating-properties-panel.html'"></div>

            <!-- Modals - Templates cargados dentro del contexto Alpine -->
            <div x-template="'templates/modals/work-area-modal.html'"></div>
            <div x-template="'templates/modals/global-config-modal.html'"></div>
            <div x-template="'templates/modals/grbl-settings-modal.html'"></div>
            <div x-template="'templates/modals/help-modal.html'"></div>
            <div x-template="'templates/modals/tools-modal.html'"></div>

        </div><!-- Fin App Container -->

        <!-- Scripts - Cargar en orden correcto -->
        <script src="js/i18n.js"></script>
        <script src="js/template-loader.js"></script>
        <script src="js/canvas-manager.js"></script>
        <script src="js/gcode-generator.js"></script>
        <script src="js/gcode-viewer.js"></script>
        <script src="js/serial-control.js"></script>
        <script src="js/library-manager.js"></script>
        <script src="js/app.js"></script>

        <!-- Alpine.js - √öLTIMO -->
        <script defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    </body>
</html>
