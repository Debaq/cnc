<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GRBL Web Control Pro v3.0</title>
        <link rel="icon" type="image/x-icon" href="favicon.ico">

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
        tailwind.config = {
            suppressWarnings: true,
            theme: {
                extend: {
                    colors: {
                        purple: {
                            dark: '#2D1B69',
                            medium: '#5B4B9F',
                            light: '#7B6BB8',
                            pale: '#B5A8D6',
                            'ultra-pale': '#E8E4F3',
                            bg: '#F5F3FA'
                        }
                    }
                }
            }
        }
    </script>

        <!-- Fabric.js for canvas manipulation -->
        <script
            src="https://cdn.jsdelivr.net/npm/fabric@6.7.1/dist/index.min.js"></script>

        <!-- Makerjs for G-code generation -->
        <script src="https://maker.js.org/target/js/browser.maker.js" type="text/javascript"></script>


        <!-- Three.js for 3D G-code visualization -->
        <script src="https://unpkg.com/three@0.147.0/build/three.min.js"></script>
        <script src="https://unpkg.com/three@0.147.0/examples/js/controls/OrbitControls.js"></script>

        <!-- Custom Styles -->
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body class="bg-purple-bg">
        <div x-data="grblApp()" class="flex h-screen overflow-hidden">

            <!-- Left Sidebar - Template Component -->
            <aside x-template="'templates/components/sidebar.html'"></aside>

            <!-- Main Content -->
            <main class="flex-1 flex flex-col overflow-hidden">

                <!-- Hidden file input for SVG -->
                <input type="file" accept=".svg" class="hidden"
                    x-ref="svgInput" @change="handleSVGUpload">

                <!-- Workspace Container -->
                <div class="flex-1 flex overflow-hidden">

                    <!-- Canvas Panel -->
                    <div class="flex-1 flex flex-col bg-purple-bg">

                        <!-- Canvas Toolbar -->
                        <div
                            class="bg-white border-b border-gray-200 px-6 py-3 flex items-center justify-between">
                            <!-- View Mode Selector -->
                            <div class="flex items-center gap-2 mr-4">
                                <button @click="viewMode = 'svg'; currentTab = 'elements'"
                                    :class="viewMode === 'svg' ? 'bg-purple-medium text-white' : 'bg-gray-100 text-gray-700'"
                                    class="px-3 py-1 rounded-lg text-sm transition">
                                     Dise帽o
                                </button>
                                <button @click="switchTo3DView()"
                                    :class="viewMode === '3d' ? 'bg-purple-medium text-white' : 'bg-gray-100 text-gray-700'"
                                    :disabled="!gcodeGenerated"
                                    class="px-3 py-1 rounded-lg text-sm transition disabled:opacity-50 disabled:cursor-not-allowed">
                                     Vista 3D
                                </button>
                            </div>

                            <div class="flex items-center gap-2">
                                <div class="flex items-center gap-3">
                                    <!-- Position controls -->
                                    <div class="flex items-center gap-1">
                                        <span class="text-xs text-gray-600 font-semibold">X:</span>
                                        <input type="number"
                                            x-model.number="svgX"
                                            @input="updateSVGPosition()"
                                            step="1"
                                            class="w-16 px-2 py-1 border border-gray-300 rounded text-xs text-right">
                                        <span class="text-xs text-gray-500">mm</span>
                                    </div>

                                    <div class="flex items-center gap-1">
                                        <span class="text-xs text-gray-600 font-semibold">Y:</span>
                                        <input type="number"
                                            x-model.number="svgY"
                                            @input="updateSVGPosition()"
                                            step="1"
                                            class="w-16 px-2 py-1 border border-gray-300 rounded text-xs text-right">
                                        <span class="text-xs text-gray-500">mm</span>
                                    </div>

                                    <div class="h-6 w-px bg-gray-300"></div>

                                    <!-- Size controls -->
                                    <div class="flex items-center gap-1">
                                        <span
                                            class="text-xs text-gray-600">W:</span>
                                        <input type="number"
                                            x-model.number="svgWidth"
                                            @input="updateSVGWidth()"
                                            step="1"
                                            min="1"
                                            class="w-16 px-2 py-1 border border-gray-300 rounded text-xs text-right">
                                        <span
                                            class="text-xs text-gray-500">mm</span>
                                    </div>

                                    <button
                                        @click="proportionalScale = !proportionalScale"
                                        :class="proportionalScale ? 'bg-purple-medium text-white' : 'bg-gray-200'"
                                        class="px-2 py-1 rounded transition"
                                        title="Escala proporcional">
                                        <span
                                            x-show="proportionalScale"></span>
                                        <span
                                            x-show="!proportionalScale"></span>
                                    </button>

                                    <div class="flex items-center gap-1">
                                        <span
                                            class="text-xs text-gray-600">H:</span>
                                        <input type="number"
                                            x-model.number="svgHeight"
                                            @input="updateSVGHeight()"
                                            step="1"
                                            min="1"
                                            class="w-16 px-2 py-1 border border-gray-300 rounded text-xs text-right">
                                        <span
                                            class="text-xs text-gray-500">mm</span>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="flex items-center gap-4 text-sm text-gray-600">
                                <span>rea: <span x-text="workAreaSize"></span>
                                    mm</span>
                                <button @click="openModal('workArea')"
                                    class="hover:text-purple-medium">锔</button>
                            </div>

                            <div class="flex items-center gap-2">
                                <!-- Herramientas de Transformaci贸n -->
                                <button @click="flipHorizontal"
                                    :disabled="!svgLoaded && elements.length === 0"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm disabled:opacity-50"
                                    title="Reflejar horizontalmente">
                                    锔
                                </button>
                                <button @click="flipVertical"
                                    :disabled="!svgLoaded && elements.length === 0"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm disabled:opacity-50"
                                    title="Reflejar verticalmente">
                                    锔
                                </button>
                                <div class="h-6 w-px bg-gray-300 mx-1"></div>

                                <!-- Herramientas de Vista -->
                                <button @click="zoomIn"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm">
                                    +
                                </button>
                                <button @click="zoomOut"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm">
                                    -
                                </button>
                                <button @click="fitView"
                                    class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-sm"
                                    title="Centrar 谩rea de trabajo">
                                    
                                </button>
                            </div>
                        </div>

                        <!-- Canvas Area - SVG & 3D Views -->
                        <div class="flex-1 p-4 relative overflow-hidden">
                            <!-- SVG Canvas -->
                            <div x-show="viewMode === 'svg'" style="width: 100%; height: 100%;">
                                <canvas x-ref="canvas"
                                    class="rounded-lg shadow-lg" style="display: block;"></canvas>
                            </div>

                            <!-- 3D Viewer Canvas -->
                            <div x-show="viewMode === '3d'" class="w-full h-full bg-gray-900 rounded-lg shadow-lg relative">
                                <canvas x-ref="viewer3d"
                                    class="w-full h-full rounded-lg"></canvas>

                                <!-- Loading overlay for 3D view -->
                                <div x-show="!gcodeGenerated"
                                    class="absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-90 rounded-lg">
                                    <div class="text-center text-gray-400">
                                        <div class="text-6xl mb-4"></div>
                                        <p class="text-lg font-semibold">Vista 3D no disponible</p>
                                        <p class="text-sm mt-2">Genera G-code primero para ver</p>
                                        <p class="text-sm">la visualizaci贸n 3D de las trayectorias</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Canvas Footer -->
                        <div
                            class="bg-white border-t border-gray-200 px-6 py-3 flex items-center justify-between text-sm text-gray-600">
                            <div class="flex items-center gap-6">
                                <span>Posici贸n: <span
                                        x-text="svgPosition"></span></span>
                                <span>Escala: <span
                                        x-text="svgScale"></span></span>
                                <span>Rotaci贸n: <span
                                        x-text="svgRotation"></span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel -->
                    <div
                        class="w-96 bg-white border-l border-gray-200 flex flex-col">

                        <!-- Tabs -->
                        <div class="flex border-b border-gray-200 bg-gray-50">
                            <template x-for="tab in tabs" :key="tab.id">
                                <button @click="currentTab = tab.id"
                                    :class="currentTab === tab.id ? 'border-b-2 border-purple-medium bg-white font-semibold' : 'text-gray-600'"
                                    class="flex-1 px-4 py-3 text-sm transition"
                                    x-text="tab.icon + ' ' + tab.name">
                                </button>
                            </template>
                        </div>

                        <!-- Tab Content -->
                        <div class="flex-1 overflow-y-auto p-6" x-template="'templates/tabs/all-tabs.html'">

                        </div>
                    </div>

                </div>
            </main>

        </div>

        <!-- Modals - Templates -->
        <div x-template="'templates/modals/work-area-modal.html'"></div>
        <div x-template="'templates/modals/grbl-settings-modal.html'"></div>
        <div x-template="'templates/modals/help-modal.html'"></div>
        <div x-template="'templates/modals/tools-modal.html'"></div>

        <!-- Scripts - Cargar en orden correcto -->
        <script src="js/i18n.js"></script>
        <script src="js/template-loader.js"></script>
        <script src="js/canvas-manager.js"></script>
        <script src="js/gcode-generator.js"></script>
        <script src="js/gcode-viewer.js"></script>
        <script src="js/serial-control.js"></script>
        <script src="js/library-manager.js"></script>
        <script src="js/app.js"></script>

        <!-- Alpine.js - LTIMO -->
        <script defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    </body>
</html>
