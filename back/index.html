<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRBL Web Control Pro</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar - Tools & Status -->
        <aside class="sidebar">
            <div class="logo">
                <h1>GRBL Control</h1>
                <div class="version">v2.0</div>
            </div>

            <!-- Connection Status -->
            <div class="status-panel">
                <div class="status-header">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="statusText">Desconectado</span>
                </div>
                <button class="btn btn-primary" id="connectBtn">Conectar</button>
                <select id="baudRate" class="input-small">
                    <option value="115200">115200</option>
                    <option value="9600">9600</option>
                </select>
            </div>

            <!-- Machine State -->
            <div class="panel" id="machineStatePanel" style="display: none;">
                <h3>Estado M√°quina</h3>
                <div class="state-grid">
                    <div class="state-item">
                        <label>Estado:</label>
                        <span id="machineState" class="state-badge">Idle</span>
                    </div>
                    <div class="state-item">
                        <label>Feed Override:</label>
                        <span id="feedOverride">100%</span>
                    </div>
                    <div class="state-item">
                        <label>Spindle Override:</label>
                        <span id="spindleOverride">100%</span>
                    </div>
                </div>
            </div>

            <!-- Position Display -->
            <div class="panel" id="positionPanel" style="display: none;">
                <h3>Posici√≥n</h3>
                <div class="position-display">
                    <div class="pos-axis">
                        <label>X:</label>
                        <span id="posX">0.000</span>
                    </div>
                    <div class="pos-axis">
                        <label>Y:</label>
                        <span id="posY">0.000</span>
                    </div>
                    <div class="pos-axis">
                        <label>Z:</label>
                        <span id="posZ">0.000</span>
                    </div>
                </div>
                <div class="position-mode">
                    <button class="btn-small" id="togglePosMode">WPos</button>
                </div>
            </div>

            <!-- Quick Controls -->
            <div class="panel" id="quickControlsPanel" style="display: none;">
                <h3>Control R√°pido</h3>
                <div class="quick-controls">
                    <button class="btn-icon" id="homeBtn" title="Home">üè†</button>
                    <button class="btn-icon" id="unlockBtn" title="Unlock">üîì</button>
                    <button class="btn-icon btn-danger" id="resetBtn" title="Reset">‚ö†Ô∏è</button>
                    <button class="btn-icon btn-danger" id="stopBtn" title="Stop">‚èπÔ∏è</button>
                </div>
            </div>

            <!-- Workspace Offset -->
            <div class="panel" id="workspacePanel" style="display: none;">
                <h3>Offset de Trabajo</h3>
                <select id="workspaceSelect" class="input-select">
                    <option value="G54">G54 (WCS 1)</option>
                    <option value="G55">G55 (WCS 2)</option>
                    <option value="G56">G56 (WCS 3)</option>
                    <option value="G57">G57 (WCS 4)</option>
                    <option value="G58">G58 (WCS 5)</option>
                    <option value="G59">G59 (WCS 6)</option>
                </select>
                <button class="btn btn-small" id="setWorkZeroBtn">Set Work Zero (G92 X0 Y0 Z0)</button>
                <button class="btn btn-small" id="clearWorkZeroBtn">Clear (G92.1)</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Toolbar -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <button class="btn" id="loadSvgBtn">üìÅ Cargar SVG</button>
                    <input type="file" id="svgInput" accept=".svg" hidden>
                    <button class="btn" id="generateGcodeBtn" disabled>‚öôÔ∏è Generar G-code</button>
                    <button class="btn" id="downloadGcodeBtn" disabled>üíæ Descargar</button>
                    <button class="btn btn-success" id="sendGcodeBtn" disabled>‚ñ∂Ô∏è Enviar a GRBL</button>
                </div>
                <div class="toolbar-group">
                    <button class="btn" id="settingsBtn">‚öôÔ∏è Config GRBL</button>
                    <button class="btn" id="toolsLibraryBtn">üîß Herramientas</button>
                    <button class="btn" id="materialsLibraryBtn">üì¶ Materiales</button>
                </div>
            </div>

            <!-- Workspace Area -->
            <div class="workspace-container">
                <!-- Canvas Panel -->
                <div class="canvas-panel">
                    <div class="canvas-toolbar">
                        <div class="canvas-tools">
                            <button class="tool-btn active" id="selectTool" title="Seleccionar">‚ÜñÔ∏è</button>
                            <button class="tool-btn" id="moveTool" title="Mover">‚úã</button>
                            <button class="tool-btn" id="scaleTool" title="Escalar">‚ÜîÔ∏è</button>
                            <button class="tool-btn" id="rotateTool" title="Rotar">üîÑ</button>
                        </div>
                        <div class="canvas-info">
                            <span>√Årea: <span id="workAreaSize">400 x 400 mm</span></span>
                            <button class="btn-small" id="editWorkAreaBtn">‚úèÔ∏è</button>
                        </div>
                        <div class="canvas-controls">
                            <button class="btn-small" id="zoomInBtn">üîç+</button>
                            <button class="btn-small" id="zoomOutBtn">üîç-</button>
                            <button class="btn-small" id="fitViewBtn">‚ä°</button>
                            <button class="btn-small" id="resetOriginBtn">üìç Origen</button>
                        </div>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="workspaceCanvas"></canvas>
                        <div class="origin-marker" id="originMarker">
                            <div class="origin-crosshair"></div>
                            <span class="origin-label">0,0</span>
                        </div>
                    </div>
                    <div class="canvas-footer">
                        <div class="transform-info">
                            <span>Posici√≥n: <span id="svgPosInfo">X: 0, Y: 0</span></span>
                            <span>Escala: <span id="svgScaleInfo">100%</span></span>
                            <span>Rotaci√≥n: <span id="svgRotationInfo">0¬∞</span></span>
                        </div>
                    </div>
                </div>

                <!-- Right Panel - Tabs -->
                <div class="right-panel">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="config">‚öôÔ∏è Configuraci√≥n</button>
                        <button class="tab-btn" data-tab="jog">üéÆ Jog</button>
                        <button class="tab-btn" data-tab="gcode">üìù G-code</button>
                        <button class="tab-btn" data-tab="console">üíª Consola</button>
                    </div>

                    <!-- Config Tab -->
                    <div class="tab-content active" data-tab="config">
                        <div class="config-section">
                            <h3>Tipo de Operaci√≥n</h3>
                            <select id="operationType" class="input-select">
                                <option value="cut">Corte CNC</option>
                                <option value="laser">L√°ser</option>
                            </select>
                        </div>

                        <div class="config-section">
                            <h3>Herramienta</h3>
                            <select id="toolSelect" class="input-select">
                                <option value="">Seleccionar herramienta...</option>
                            </select>
                            <button class="btn-small" id="newToolBtn">+ Nueva</button>
                        </div>

                        <div class="config-section">
                            <h3>Material</h3>
                            <select id="materialSelect" class="input-select">
                                <option value="">Seleccionar material...</option>
                            </select>
                            <button class="btn-small" id="newMaterialBtn">+ Nuevo</button>
                        </div>

                        <div class="config-section cnc-only">
                            <h3>Par√°metros CNC</h3>
                            <div class="input-group">
                                <label>Profundidad total (mm):</label>
                                <input type="number" id="depth" value="-3" step="0.1" class="input-field">
                            </div>
                            <div class="input-group">
                                <label>Profundidad por pasada (mm):</label>
                                <input type="number" id="depthStep" value="1" step="0.1" class="input-field">
                            </div>
                            <div class="input-group">
                                <label>Di√°metro herramienta (mm):</label>
                                <input type="number" id="toolDiameter" value="3.175" step="0.001" class="input-field">
                            </div>
                            <div class="input-group">
                                <label>Compensaci√≥n:</label>
                                <select id="toolCompensation" class="input-select">
                                    <option value="center">Centro (por el borde)</option>
                                    <option value="inside">Interior (dentro)</option>
                                    <option value="outside">Exterior (fuera)</option>
                                </select>
                            </div>
                        </div>

                        <div class="config-section">
                            <h3>Velocidades</h3>
                            <div class="input-group">
                                <label>Feed rate (mm/min):</label>
                                <input type="number" id="feedRate" value="800" step="50" class="input-field">
                            </div>
                            <div class="input-group cnc-only">
                                <label>Plunge rate (mm/min):</label>
                                <input type="number" id="plungeRate" value="400" step="50" class="input-field">
                            </div>
                            <div class="input-group cnc-only">
                                <label>Spindle RPM:</label>
                                <input type="number" id="spindleRPM" value="10000" step="1000" class="input-field">
                            </div>
                            <div class="input-group laser-only" style="display: none;">
                                <label>Potencia l√°ser (%):</label>
                                <input type="number" id="laserPower" value="80" min="0" max="100" class="input-field">
                            </div>
                        </div>

                        <div class="config-section">
                            <h3>Estimaciones</h3>
                            <div class="estimate-info">
                                <div class="estimate-item">
                                    <label>Tiempo estimado:</label>
                                    <span id="estimatedTime">--</span>
                                </div>
                                <div class="estimate-item">
                                    <label>Distancia total:</label>
                                    <span id="totalDistance">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Jog Tab -->
                    <div class="tab-content" data-tab="jog" style="display: none;">
                        <div class="jog-panel">
                            <h3>Control Manual</h3>
                            
                            <div class="jog-distance">
                                <label>Distancia:</label>
                                <div class="distance-buttons">
                                    <button class="btn-distance" data-distance="0.1">0.1</button>
                                    <button class="btn-distance active" data-distance="1">1</button>
                                    <button class="btn-distance" data-distance="10">10</button>
                                    <button class="btn-distance" data-distance="100">100</button>
                                </div>
                                <span class="distance-unit">mm</span>
                            </div>

                            <div class="jog-speed">
                                <label>Velocidad:</label>
                                <input type="range" id="jogSpeed" min="100" max="5000" value="1000" step="100">
                                <span id="jogSpeedValue">1000</span> mm/min
                            </div>

                            <div class="jog-controls-xy">
                                <button class="jog-btn" data-axis="Y" data-dir="1">‚ñ≤</button>
                                <div class="jog-middle">
                                    <button class="jog-btn" data-axis="X" data-dir="-1">‚óÑ</button>
                                    <button class="jog-btn jog-home" id="jogHomeBtn">‚åÇ</button>
                                    <button class="jog-btn" data-axis="X" data-dir="1">‚ñ∫</button>
                                </div>
                                <button class="jog-btn" data-axis="Y" data-dir="-1">‚ñº</button>
                            </div>

                            <div class="jog-controls-z">
                                <button class="jog-btn-z" data-axis="Z" data-dir="1">Z ‚ñ≤</button>
                                <button class="jog-btn-z" data-axis="Z" data-dir="-1">Z ‚ñº</button>
                            </div>

                            <div class="jog-actions">
                                <button class="btn" id="goToOriginBtn">Ir a Origen (G0 X0 Y0 Z0)</button>
                                <button class="btn" id="probeZBtn">Probe Z</button>
                            </div>
                        </div>
                    </div>

                    <!-- G-code Tab -->
                    <div class="tab-content" data-tab="gcode" style="display: none;">
                        <div class="gcode-panel">
                            <div class="gcode-header">
                                <h3>G-code Generado</h3>
                                <div class="gcode-stats">
                                    <span id="gcodeLines">0 l√≠neas</span>
                                </div>
                            </div>
                            <textarea id="gcodeOutput" readonly placeholder="El G-code aparecer√° aqu√≠..."></textarea>
                            <div class="gcode-progress" id="gcodeProgress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill"></div>
                                </div>
                                <span id="progressText">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Console Tab -->
                    <div class="tab-content" data-tab="console" style="display: none;">
                        <div class="console-panel">
                            <div class="console-header">
                                <h3>Consola GRBL</h3>
                                <button class="btn-small" id="clearConsoleBtn">Limpiar</button>
                            </div>
                            <div class="console-output" id="consoleOutput"></div>
                            <div class="console-input-wrapper">
                                <input type="text" id="consoleInput" placeholder="Comando manual..." disabled>
                                <button class="btn-small" id="sendCommandBtn" disabled>Enviar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Work Area Settings Modal -->
    <div class="modal" id="workAreaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configurar √Årea de Trabajo</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Ancho (mm):</label>
                    <input type="number" id="workAreaWidth" value="400" step="10" class="input-field">
                </div>
                <div class="input-group">
                    <label>Alto (mm):</label>
                    <input type="number" id="workAreaHeight" value="400" step="10" class="input-field">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelWorkAreaBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveWorkAreaBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- GRBL Settings Modal -->
    <div class="modal" id="grblSettingsModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Configuraci√≥n GRBL</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab-btn active" data-tab="limits">L√≠mites</button>
                    <button class="settings-tab-btn" data-tab="steps">Steps</button>
                    <button class="settings-tab-btn" data-tab="speeds">Velocidades</button>
                    <button class="settings-tab-btn" data-tab="all">Todos</button>
                </div>
                <div class="settings-content" id="grblSettingsContent">
                    <p>Conecta a GRBL para ver la configuraci√≥n...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeSettingsBtn">Cerrar</button>
                <button class="btn btn-primary" id="refreshSettingsBtn">Refrescar</button>
            </div>
        </div>
    </div>

    <!-- Tool Library Modal -->
    <div class="modal" id="toolLibraryModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Biblioteca de Herramientas</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="library-list" id="toolsList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeToolsLibraryBtn">Cerrar</button>
                <button class="btn btn-primary" id="addToolBtn">+ Nueva Herramienta</button>
            </div>
        </div>
    </div>

    <!-- Material Library Modal -->
    <div class="modal" id="materialLibraryModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Biblioteca de Materiales</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="library-list" id="materialsList"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeMaterialsLibraryBtn">Cerrar</button>
                <button class="btn btn-primary" id="addMaterialBtn">+ Nuevo Material</button>
            </div>
        </div>
    </div>

    <!-- Tool Editor Modal -->
    <div class="modal" id="toolEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="toolEditorTitle">Nueva Herramienta</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Nombre:</label>
                    <input type="text" id="toolName" class="input-field" placeholder="Ej: Fresa 3mm">
                </div>
                <div class="input-group">
                    <label>Tipo:</label>
                    <select id="toolType" class="input-select">
                        <option value="endmill">End Mill</option>
                        <option value="ballnose">Ball Nose</option>
                        <option value="vbit">V-Bit</option>
                        <option value="drill">Broca</option>
                        <option value="laser">L√°ser</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Di√°metro (mm):</label>
                    <input type="number" id="toolDiameterEdit" class="input-field" value="3.175" step="0.001">
                </div>
                <div class="input-group">
                    <label>N√∫mero de flautas:</label>
                    <input type="number" id="toolFlutes" class="input-field" value="2" min="1">
                </div>
                <div class="input-group">
                    <label>Material herramienta:</label>
                    <select id="toolMaterial" class="input-select">
                        <option value="hss">HSS (High Speed Steel)</option>
                        <option value="carbide">Carburo</option>
                        <option value="cobalt">Cobalto</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Feed rate recomendado (mm/min):</label>
                    <input type="number" id="toolFeedRate" class="input-field" value="800" step="50">
                </div>
                <div class="input-group">
                    <label>RPM recomendado:</label>
                    <input type="number" id="toolRPM" class="input-field" value="10000" step="1000">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelToolBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveToolBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Material Editor Modal -->
    <div class="modal" id="materialEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="materialEditorTitle">Nuevo Material</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Nombre:</label>
                    <input type="text" id="materialName" class="input-field" placeholder="Ej: MDF 9mm">
                </div>
                <div class="input-group">
                    <label>Tipo:</label>
                    <select id="materialType" class="input-select">
                        <option value="wood">Madera</option>
                        <option value="mdf">MDF</option>
                        <option value="plywood">Terciado/Plywood</option>
                        <option value="acrylic">Acr√≠lico</option>
                        <option value="aluminum">Aluminio</option>
                        <option value="foam">Foam</option>
                        <option value="other">Otro</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Espesor (mm):</label>
                    <input type="number" id="materialThickness" class="input-field" value="3" step="0.1">
                </div>
                <div class="input-group">
                    <label>Profundidad por pasada recomendada (mm):</label>
                    <input type="number" id="materialDepthPerPass" class="input-field" value="1" step="0.1">
                </div>
                <div class="input-group">
                    <label>Feed rate recomendado (mm/min):</label>
                    <input type="number" id="materialFeedRate" class="input-field" value="800" step="50">
                </div>
                <div class="input-group">
                    <label>RPM recomendado:</label>
                    <input type="number" id="materialRPM" class="input-field" value="10000" step="1000">
                </div>
                <div class="input-group">
                    <label>Potencia l√°ser recomendada (%):</label>
                    <input type="number" id="materialLaserPower" class="input-field" value="60" min="0" max="100">
                </div>
                <div class="input-group">
                    <label>Velocidad l√°ser recomendada (mm/min):</label>
                    <input type="number" id="materialLaserSpeed" class="input-field" value="1000" step="100">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelMaterialBtn">Cancelar</button>
                <button class="btn btn-primary" id="saveMaterialBtn">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Password Prompt Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Contrase√±a requerida</h2>
            </div>
            <div class="modal-body">
                <p>Ingresa la contrase√±a para guardar en el servidor:</p>
                <div class="input-group">
                    <input type="password" id="passwordInput" class="input-field" placeholder="Contrase√±a">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelPasswordBtn">Cancelar</button>
                <button class="btn btn-primary" id="submitPasswordBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
