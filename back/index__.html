<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRBL Web Control Pro v3.0</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        purple: {
                            dark: '#5B4B9F',
                            medium: '#7B6BB8',
                            light: '#9B8BC8',
                            pale: '#BBA9D9',
                            'ultra-pale': '#E8E6F0',
                            bg: '#F5F4F9'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- External Libraries -->
    <!-- Fabric.js - Canvas manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/fabric@6.7.1/dist/fabric.min.js"></script>

    <!-- Maker.js - Parametric geometry -->
    <script src="https://maker.js.org/target/js/browser.maker.js"></script>

    <!-- Three.js - 3D visualization -->
    <script src="https://unpkg.com/three@0.147.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.147.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body class="bg-purple-bg">
    <!-- Main App Container -->
    <div id="app" x-data="grblApp()">
        <!-- App Layout -->
        <div class="flex h-screen overflow-hidden">

            <!-- Left Sidebar Component -->
            <div x-template="'templates/components/sidebar.html'"></div>

            <!-- Main Content Area -->
            <main class="flex-1 flex flex-col overflow-hidden">

                <!-- Canvas Toolbar -->
                <div class="bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <!-- View Toggle -->
                        <div class="flex bg-gray-100 rounded-lg p-1">
                            <button @click="currentView = 'design'"
                                :class="currentView === 'design' ? 'bg-white shadow' : ''"
                                class="px-4 py-1.5 text-sm font-medium rounded transition">
                                üé® Dise√±o
                            </button>
                            <button @click="currentView = 'viewer3d'"
                                :class="currentView === 'viewer3d' ? 'bg-white shadow' : ''"
                                class="px-4 py-1.5 text-sm font-medium rounded transition">
                                üì¶ Vista 3D
                            </button>
                        </div>

                        <!-- Position Info -->
                        <div class="text-sm text-gray-600">
                            <span x-text="`Posici√≥n: (${Math.round(canvasInfo.mouseX)}, ${Math.round(canvasInfo.mouseY)})`"></span>
                        </div>

                        <!-- Zoom Info -->
                        <div class="text-sm text-gray-600">
                            <span x-text="`Zoom: ${Math.round(canvasInfo.zoom * 100)}%`"></span>
                        </div>
                    </div>

                    <!-- Canvas Tools -->
                    <div class="flex items-center gap-2">
                        <button @click="zoomIn()"
                            class="px-3 py-1.5 bg-purple-ultra-pale hover:bg-purple-pale rounded transition text-sm"
                            title="Acercar">üîç+</button>
                        <button @click="zoomOut()"
                            class="px-3 py-1.5 bg-purple-ultra-pale hover:bg-purple-pale rounded transition text-sm"
                            title="Alejar">üîç-</button>
                        <button @click="zoomToFit()"
                            class="px-3 py-1.5 bg-purple-ultra-pale hover:bg-purple-pale rounded transition text-sm"
                            title="Ajustar">‚äû</button>
                        <button @click="centerCanvas()"
                            class="px-3 py-1.5 bg-purple-ultra-pale hover:bg-purple-pale rounded transition text-sm"
                            title="Centrar">‚äï</button>
                    </div>
                </div>

                <!-- Canvas Area -->
                <div class="flex-1 relative overflow-hidden" x-show="currentView === 'design'">
                    <canvas id="canvas"></canvas>
                </div>

                <!-- 3D Viewer Area -->
                <div class="flex-1 relative overflow-hidden bg-gray-900" x-show="currentView === 'viewer3d'">
                    <div id="viewer3d"></div>
                </div>

                <!-- Canvas Footer / Selection Info -->
                <div class="bg-white border-t border-gray-200 px-4 py-2">
                    <div class="flex items-center justify-between text-xs text-gray-600">
                        <div x-show="selectedObject">
                            <span>Seleccionado: </span>
                            <span x-text="selectedObject ? selectedObject.type : 'Ninguno'"></span>
                            <span x-show="selectedObject" class="ml-4">
                                Posici√≥n: (<span x-text="selectedObject ? Math.round(selectedObject.left) : 0"></span>,
                                <span x-text="selectedObject ? Math.round(selectedObject.top) : 0"></span>)
                            </span>
                            <span x-show="selectedObject" class="ml-4">
                                Escala: <span x-text="selectedObject ? Math.round(selectedObject.scaleX * 100) : 100"></span>%
                            </span>
                            <span x-show="selectedObject && selectedObject.angle" class="ml-4">
                                Rotaci√≥n: <span x-text="selectedObject ? Math.round(selectedObject.angle) : 0"></span>¬∞
                            </span>
                        </div>
                        <div x-show="!selectedObject" class="text-gray-400">
                            Sin selecci√≥n
                        </div>
                        <div>
                            <span>Elementos: <span x-text="canvasObjects.length"></span></span>
                        </div>
                    </div>
                </div>

            </main>

            <!-- Right Panel with Tabs -->
            <aside class="w-96 bg-white border-l border-gray-200 flex flex-col">
                <!-- Tab Headers -->
                <div class="border-b border-gray-200 flex">
                    <button @click="currentTab = 'elements'"
                        :class="currentTab === 'elements' ? 'bg-purple-ultra-pale border-b-2 border-purple-dark text-purple-dark' : 'text-gray-600 hover:bg-gray-50'"
                        class="flex-1 px-4 py-3 text-sm font-medium transition">
                        üìê Elementos
                    </button>
                    <button @click="currentTab = 'jog'"
                        :class="currentTab === 'jog' ? 'bg-purple-ultra-pale border-b-2 border-purple-dark text-purple-dark' : 'text-gray-600 hover:bg-gray-50'"
                        class="flex-1 px-4 py-3 text-sm font-medium transition">
                        üéÆ Jog
                    </button>
                    <button @click="currentTab = 'gcode'"
                        :class="currentTab === 'gcode' ? 'bg-purple-ultra-pale border-b-2 border-purple-dark text-purple-dark' : 'text-gray-600 hover:bg-gray-50'"
                        class="flex-1 px-4 py-3 text-sm font-medium transition">
                        üìù G-code
                    </button>
                    <button @click="currentTab = 'console'"
                        :class="currentTab === 'console' ? 'bg-purple-ultra-pale border-b-2 border-purple-dark text-purple-dark' : 'text-gray-600 hover:bg-gray-50'"
                        class="flex-1 px-4 py-3 text-sm font-medium transition">
                        üí¨ Consola
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="flex-1 overflow-auto">
                    <!-- Elements Tab -->
                    <div x-show="currentTab === 'elements'" class="p-4">
                        <div x-template="'templates/tabs/elements-tab.html'"></div>
                    </div>

                    <!-- Jog Tab -->
                    <div x-show="currentTab === 'jog'" class="p-4">
                        <div x-template="'templates/tabs/jog-tab.html'"></div>
                    </div>

                    <!-- G-code Tab -->
                    <div x-show="currentTab === 'gcode'" class="p-4">
                        <div x-template="'templates/tabs/gcode-tab.html'"></div>
                    </div>

                    <!-- Console Tab -->
                    <div x-show="currentTab === 'console'" class="p-4">
                        <div x-template="'templates/tabs/console-tab.html'"></div>
                    </div>
                </div>
            </aside>

        </div>

        <!-- Modals -->
        <div x-template="'templates/modals/grbl-settings-modal.html'"></div>
        <div x-template="'templates/modals/tools-modal.html'"></div>
        <div x-template="'templates/modals/work-area-modal.html'"></div>
        <div x-template="'templates/modals/help-modal.html'"></div>

        <!-- Hidden File Input -->
        <input type="file" id="svgFileInput" accept=".svg" style="display: none;">

    </div>

    <!-- Application Scripts -->
    <!-- Load order is important! -->
    <script src="js/i18n.js"></script>
    <script src="js/template-loader.js"></script>
    <script src="js/canvas-manager.js"></script>
    <script src="js/gcode-generator.js"></script>
    <script src="js/gcode-viewer.js"></script>
    <script src="js/serial-control.js"></script>
    <script src="js/library-manager.js"></script>
    <script src="js/app.js"></script>

    <!-- Alpine.js - Must be loaded last -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

</body>
</html>
